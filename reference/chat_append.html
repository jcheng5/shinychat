<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Append an assistant response (or user message) to a chat control — chat_append • shinychat</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Append an assistant response (or user message) to a chat control — chat_append"><meta name="description" content="The chat_append function appends a message to an existing chat control. The
response can be a string, string generator, string promise, or string
promise generator (as returned by the 'elmer' package's chat, stream,
chat_async, and stream_async methods, respectively).
This function should be called from a Shiny app's server. It is generally
used to append the model's response to the chat, while user messages are
added to the chat UI automatically by the front-end. You'd only need to use
chat_append(role=&quot;user&quot;) if you are programmatically generating queries
from the server and sending them on behalf of the user, and want them to be
reflected in the UI."><meta property="og:description" content="The chat_append function appends a message to an existing chat control. The
response can be a string, string generator, string promise, or string
promise generator (as returned by the 'elmer' package's chat, stream,
chat_async, and stream_async methods, respectively).
This function should be called from a Shiny app's server. It is generally
used to append the model's response to the chat, while user messages are
added to the chat UI automatically by the front-end. You'd only need to use
chat_append(role=&quot;user&quot;) if you are programmatically generating queries
from the server and sending them on behalf of the user, and want them to be
reflected in the UI."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">shinychat</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/jcheng5/shinychat/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Append an assistant response (or user message) to a chat control</h1>
      <small class="dont-index">Source: <a href="https://github.com/jcheng5/shinychat/blob/main/R/chat.R" class="external-link"><code>R/chat.R</code></a></small>
      <div class="d-none name"><code>chat_append.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>The <code>chat_append</code> function appends a message to an existing chat control. The
<code>response</code> can be a string, string generator, string promise, or string
promise generator (as returned by the 'elmer' package's <code>chat</code>, <code>stream</code>,
<code>chat_async</code>, and <code>stream_async</code> methods, respectively).</p>
<p>This function should be called from a Shiny app's server. It is generally
used to append the model's response to the chat, while user messages are
added to the chat UI automatically by the front-end. You'd only need to use
<code>chat_append(role="user")</code> if you are programmatically generating queries
from the server and sending them on behalf of the user, and want them to be
reflected in the UI.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">chat_append</span><span class="op">(</span></span>
<span>  <span class="va">id</span>,</span>
<span>  <span class="va">response</span>,</span>
<span>  role <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"assistant"</span>, <span class="st">"user"</span><span class="op">)</span>,</span>
<span>  session <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/domains.html" class="external-link">getDefaultReactiveDomain</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-id">id<a class="anchor" aria-label="anchor" href="#arg-id"></a></dt>
<dd><p>The ID of the chat element</p></dd>


<dt id="arg-response">response<a class="anchor" aria-label="anchor" href="#arg-response"></a></dt>
<dd><p>The message or message stream to append to the chat element</p></dd>


<dt id="arg-role">role<a class="anchor" aria-label="anchor" href="#arg-role"></a></dt>
<dd><p>The role of the message (either "assistant" or "user"). Defaults
to "assistant".</p></dd>


<dt id="arg-session">session<a class="anchor" aria-label="anchor" href="#arg-session"></a></dt>
<dd><p>The Shiny session object</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Returns a promise. This promise resolves when the message has been
successfully sent to the client; note that it does not guarantee that the
message was actually received or rendered by the client. The promise
rejects if an error occurs while processing the response (see the "Error
handling" section).</p>
    </div>
    <div class="section level2">
    <h2 id="error-handling">Error handling<a class="anchor" aria-label="anchor" href="#error-handling"></a></h2>
    <p>If the <code>response</code> argument is a generator, promise, or promise generator, and
an error occurs while producing the message (e.g., an iteration in
<code>stream_async</code> fails), the promise returned by <code>chat_append</code> will reject with
the error. If the <code>chat_append</code> call is the last expression in a Shiny
observer, Shiny will see that the observer failed, and end the user session.
If you prefer to handle the error gracefully, use <code><a href="https://rstudio.github.io/promises/reference/then.html" class="external-link">promises::catch()</a></code> on the
promise returned by <code>chat_append</code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># interactive()</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.posit.co/" class="external-link">shiny</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-lib/coro" class="external-link">coro</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/bslib/" class="external-link">bslib</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jcheng5/shinychat" class="external-link">shinychat</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Dumbest chatbot in the world: ignores user input and chooses</span></span></span>
<span class="r-in"><span><span class="co"># a random, vague response.</span></span></span>
<span class="r-in"><span><span class="va">fake_chatbot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://coro.r-lib.org/reference/async_generator.html" class="external-link">async_generator</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">input</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">responses</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="st">"What does that suggest to you?"</span>,</span></span>
<span class="r-in"><span>    <span class="st">"I see."</span>,</span></span>
<span class="r-in"><span>    <span class="st">"I'm not sure I understand you fully."</span>,</span></span>
<span class="r-in"><span>    <span class="st">"What do you think?"</span>,</span></span>
<span class="r-in"><span>    <span class="st">"Can you elaborate on that?"</span>,</span></span>
<span class="r-in"><span>    <span class="st">"Interesting question! Let's examine thi... **See more**"</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://coro.r-lib.org/reference/async.html" class="external-link">await</a></span><span class="op">(</span><span class="fu"><a href="https://coro.r-lib.org/reference/async_sleep.html" class="external-link">async_sleep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="kw">for</span> <span class="op">(</span><span class="va">chunk</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/strsplit.html" class="external-link">strsplit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">responses</span>, <span class="fl">1</span><span class="op">)</span>, <span class="st">""</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://coro.r-lib.org/reference/yield.html" class="external-link">yield</a></span><span class="op">(</span><span class="va">chunk</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://coro.r-lib.org/reference/async.html" class="external-link">await</a></span><span class="op">(</span><span class="fu"><a href="https://coro.r-lib.org/reference/async_sleep.html" class="external-link">async_sleep</a></span><span class="op">(</span><span class="fl">0.02</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span><span class="op">}</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rstudio.github.io/bslib/reference/page_fillable.html" class="external-link">page_fillable</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="chat_ui.html">chat_ui</a></span><span class="op">(</span><span class="st">"chat"</span>, fill <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html" class="external-link">observeEvent</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">chat_user_input</span>, <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="va">response</span> <span class="op">&lt;-</span> <span class="fu">fake_chatbot</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">chat_user_input</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="fu">chat_append</span><span class="op">(</span><span class="st">"chat"</span>, <span class="va">response</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html" class="external-link">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Joe Cheng, Carson Sievert, Posit Software, PBC.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

